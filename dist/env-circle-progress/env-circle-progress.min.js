!function(t){function e(t,e,i){return{x:t.x+e*Math.cos(Math.PI*i/180),y:t.y+e*Math.sin(Math.PI*i/180)}}function i(t,e){return t-Math.floor(t/e)*e}function s(t,e,s){return t=i(t,360),e=i(e,360),s?t>e?t-e:360-(e-t):e>t?e-t:360-(t-e)}function n(t,n,o,r,l,a){if(r==l)return"M0 0";var c="";if(r=i(r,360),l=i(l,360),a=1==a,r!=l){var p=e(t,n,r),u=e(t,o,r),h=e(t,n,l),g=e(t,o,l),v=s(r,l,a),f=v>=180?1:0;c="M"+p.x+" "+p.y+" A"+n+" "+n+" 0 "+f+" "+(a?0:1)+" "+h.x+" "+h.y+" L"+g.x+" "+g.y+" A"+o+" "+o+" 0 "+f+" "+(a?1:0)+" "+u.x+" "+u.y+" Z"}else{var d=arguments.callee(t,n,o,r,r+180,a),x=arguments.callee(t,n,o,r,r+180,!a);c=d+" "+x}return c}function o(t){var e=document.createElementNS(v,"svg");return e.setAttribute("version","1.2"),e.setAttribute("width",t),e.setAttribute("height",t),e.setAttribute("contentScriptType","text/ecmascript"),e.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),e.setAttribute("baseProfile","tiny"),e.setAttribute("zoomAndPan","magnify"),e.setAttribute("contentStyleType","text/css"),e.setAttribute("preserveAspectRatio","xMidYMid meet"),e.setAttribute("xmlns",v),e.setAttribute("stroke","none"),e}function r(){this._svgSize=Math.min(this._$svgCntr.height(),this._$svgCntr.width()),this._svgOrigin={x:this._svgSize/2,y:this._svgSize/2};var t=this._svg=o(this._svgSize),i=this.circles;for(var s in i){var r=i[s];if(r.bg=document.createElementNS(v,"path"),r.element=document.createElementNS(v,"path"),null!=r.options.className&&null!=r.options.className.bg?r.bg.setAttribute("class",m.circleBg+" "+r.options.className.bg):r.bg.setAttribute("class",m.circleBg),r.bg.setAttribute("fill",r.options.color.bg||""),r.bg.setAttribute("d",n(this._svgOrigin,this._svgSize/2-a(r.options.margin,this._svgSize),this._svgSize/2-a(r.options.margin,this._svgSize)-a(r.options.width,this._svgSize),r.options.startAngle,1==r.options.anticlockwise?r.options.startAngle-r.options.angleRange:r.options.startAngle+r.options.angleRange,r.options.anticlockwise)),null!=r.options.className&&null!=r.options.className.fill?r.element.setAttribute("class",m.circleFill+" "+r.options.className.fill):r.element.setAttribute("class",m.circleFill),r.element.setAttribute("fill",r.options.color.fill||""),t.appendChild(r.bg),t.appendChild(r.element),null!=r.options.target&&r.options.target.show){r.targetLine=document.createElementNS(v,"line");var l=parseFloat(r.options.target.value)/100,p=1==r.options.anticlockwise?r.options.startAngle-r.options.angleRange*l:r.options.startAngle+r.options.angleRange*l,u=e(this._svgOrigin,this._svgSize/2-a(r.options.margin,this._svgSize),p),h=e(this._svgOrigin,this._svgSize/2-a(r.options.margin,this._svgSize)-a(r.options.width,this._svgSize),p);r.targetLine.setAttribute("x1",u.x),r.targetLine.setAttribute("y1",u.y),r.targetLine.setAttribute("x2",h.x),r.targetLine.setAttribute("y2",h.y),r.targetLine.style.stroke=r.options.color.target||"#d50000",r.targetLine.style.strokeWidth=r.options.target.width,t.appendChild(r.targetLine)}}for(var s in this.circles){var r=i[s];null!=r.options.text&&r.options.text.show&&(r.text=document.createElementNS(v,"text"),null!=r.options.className&&null!=r.options.className.text?r.text.setAttribute("class",m.circleText+" "+r.options.className.text):r.text.setAttribute("class",m.circleText),r.text.setAttribute("fill",r.options.color.text||r.options.color.fill||""),r.text.setAttribute("x",this._svgSize/2),r.text.setAttribute("y",r.options.text.top||this._svgSize/2),r.text.setAttribute("font-size",r.options.text.size||""),t.appendChild(r.text)),c.call(this,r)}var g=this.texts;for(var s in g){var f=g[s];f.element=document.createElementNS(v,"text"),f.element.setAttribute("class",m.text+" "+(f.options.className||"")),f.element.setAttribute("fill",f.options.color||""),f.element.setAttribute("x",this._svgSize/2),f.element.setAttribute("y",f.options.top||this._svgSize/2),f.element.setAttribute("font-size",f.options.size||""),f.element.textContent=f.options.value||"",t.appendChild(f.element)}this._$svgCntr.append(t)}function l(t,e){if("number"==typeof e)return t[e];for(var i in t)if(t[i].id==e)return t[i]}function a(t,e){if(/^\d+(\.\d+)?\%$/.test(t)){var i=parseFloat(t);return e*i/100}return parseFloat(t)}function c(t){var e=t.curValue>100?100:t.curValue;e=0>e?0:e,t.element.setAttribute("d",n(this._svgOrigin,this._svgSize/2-a(t.options.margin,this._svgSize),this._svgSize/2-a(t.options.margin,this._svgSize)-a(t.options.width,this._svgSize),t.options.startAngle,1==t.options.anticlockwise?t.options.startAngle-t.options.angleRange*e/100:t.options.startAngle+t.options.angleRange*e/100,t.options.anticlockwise)),null!=t.options.text&&t.options.text.show&&(t.text.textContent=(t.options.text.prefix||"")+t.curValue.toFixed(this.getOptions().decimalPlaces||2)+(t.options.text.suffix||""))}function p(){var t="";for(var e in this.circles){var i=this.circles[e];t+=null!=i.options.text?"<span>"+(i.options.text.prefix||"")+i.curValue.toFixed(this.getOptions().decimalPlaces||2)+(i.options.text.suffix||"")+"</span><br>":"<span>"+i.curValue.toFixed(this.getOptions().decimalPlaces||2)+"</span><br>"}return t}function u(){var e=this,i=this.getOptions();i.showTooltip&&(this._$tooltip=t(A).hide(),this._$base.find("."+m.background).append(this._$tooltip),this._$base.mouseenter(function(t){h.call(e),e._$tooltip.fadeIn()}).mouseleave(function(){setTimeout(function(){e._$tooltip.fadeOut()},500)}))}function h(){var t=this.getOptions();if(t.showTooltip&&null!=this._$tooltip){this._$tooltip.empty();var e=t.tooltipFormatter;null!=e&&"function"==typeof e&&this._$tooltip.append(e.call(this))}}function g(e,i){if(null!=e&&e instanceof HTMLElement){var s=t(e);i=t.extend(!0,{},f,i),isNaN(parseInt(i.size))?i.size=s.width()>s.height()?s.height():s.width():i.size=parseInt(i.size),this.circles={};for(var n in i.circles)i.circles[n]=t.extend(!0,{},d,i.circles[n]),this.circles[n]={id:i.circles[n].id,options:i.circles[n],curValue:i.circles[n].initValue<100?i.circles[n].initValue:100};this.texts={};for(var n in i.texts)i.texts[n]=t.extend(!0,{},x,i.texts[n]),this.texts[n]={id:i.texts[n].id,options:i.texts[n]};var o=t(b).width(i.size).height(i.size);t(e).append(o),this.getOptions=function(){return i},this._$cntr=s,this._$base=o,this._$svgCntr=o.find("."+m.svgCntr),u.call(this),r.call(this)}}var v="http://www.w3.org/2000/svg",f={size:null,decimalPlaces:1,circles:[],texts:[],showTooltip:!0,tooltipFormatter:p},d={id:"",angleRange:300,startAngle:120,width:"5%",margin:"5%",anticlockwise:!1,enableAnimation:!0,animationStep:1,initValue:50,text:{show:!0,size:"14px",prefix:"",suffix:"%",top:"50%"},target:{show:!1,value:"100%",width:"2px"},className:{bg:"",fill:"",text:"",target:""},color:{bg:"#23252b",fill:"#21a1c1",text:"#21a1c1",target:"#d50000"}},x={id:"",value:"",size:"14px",prefix:"",suffix:"",top:"50%",className:"",color:"#fff"},m={wrapper:"ecp-wrapper",background:"ecp-bg",border:"ecp-border",svgCntr:"ecp-svg-cntr",circleBg:"ecp-cc-bg",circleFill:"ecp-cc-bg",circleText:"ecp-cc-text",text:"ecp-cc-text",tooltip:"ecp-tooltip"},b=["<div class='"+m.wrapper+"'>","<div class='"+m.background+"'>","<div class='"+m.border+"'>","<div class='"+m.svgCntr+"'></div>","</div>","</div>","</div>"].join(""),A="<div class='"+m.tooltip+"'></div>";g.prototype={constructor:g,setCircleValue:function(t,e){var i=this,s=l(this.circles,t);if(null!=s){var n=s.options.enableAnimation;if(s.curValue==e)return;n?(null!=s.timer&&clearInterval(s.timer),s.timer=setInterval(function(){return s.curValue==e?void clearInterval(s.timer):(s.curValue<e?(s.curValue+=s.options.animationStep||1,s.curValue>e&&(s.curValue=e)):(s.curValue-=s.options.animationStep||1,s.curValue<e&&(s.curValue=e)),void c.call(i,s))},10)):(s.curValue=e,c.call(i,s))}},setText:function(t,e){var i=l(this.texts,t);null!=i&&(i.element.textContent=i.options.value=e||"")},resize:function(e){e=parseInt(e)||Math.min(this._$cntr.height(),this._$cntr.width()),this._$base.width(e).height(e),t(this._svg).remove(),r.call(this)},destory:function(){this._$cntr.children().remove(),this._$cntr.removeData("envCircleProgress"),this.prototype={};for(var t in this.circles){var e=this.circles[t];for(var i in e)e[i]=null}for(var t in this.texts){var s=this.texts[t];for(var i in s)s[i]=null}for(var n in this)this.hasOwnProperty(n)&&(this[n]=null)}},t.fn.envCircleProgress=function(e){if(0==this.length)return this;if(null==e)return t(this[0]).data("envCircleProgress");if(null==g.prototype[e])return this.each(function(){var i=t(this).data("envCircleProgress");null==i&&(i=new g(this,e),t.data(this,"envCircleProgress",i))});var i=g.prototype[e],s=t(this[0]).data("envCircleProgress");return null!=s?"function"==typeof i?i.apply(s,Array.prototype.slice.call(arguments,1)):s[e]:void 0}}(jQuery);